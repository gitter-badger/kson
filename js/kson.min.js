(function(n,e){function t(n,e){return function(n,t){return null==n?n:"bool"==e?t?n&&1||0:n&&!0||!1:"int36"==e?t?n.toString(36):parseInt(n,36):"date"==e?t?Math.round(n/1e3):new Date(1e3*n):"isodate"==e?t?d.toISOString():new Date(Date.parse(n)):n}}function r(n){return"["==n[0]?n.slice(2):n}function i(n){return function(e,t){for(var r=n.length,i=t>0?0:r-1,f=t>0?r:-1;i!=f;i+=t)e=n[i](e,1!=t);return e}}function f(n){if(n&&!g[n]){var e,r,f,u,o=n.match(/(\\.|[^\|])+/g),a=[];for(e=o.length-1;e>=0;e--){if(f=o[e],u=f.match(/(\\.|[^:])+/g),f=u[0],!f||g[f])return;for(u=u.slice(1),r=u.length-1;r>=0;r--)u[r]=u[r].replace("\\","");a.push((s[f]||t)(u,f))}s[n]=i(a)}}function u(n){for(var e=n.meta.length-1;e>=0;e--)f(r(n.meta[e]))}function o(n,e,t,i){var f,u=r(e),o=s[u];if(o&&u!=e){for(n=n.slice(0),f=n.length-1;f>=0;f--)n[f]=o(n[f],i);return n}return null==n?n:g[u]?t(n,e,1):o?o(n,i):n}function a(n,e,t){var i,f,u,c=r(e),l=g[c],s=l.fields,d=[];t||(d[0]=e),c==e&&(n=[n]);var h=n.length,p=s.length;for(i=0;h>i;i++)for(u=n[i],f=0;p>f;f++)d.push(o(u[s[f]],l.meta[f],a,-1));return t?d:JSON.stringify(d)}function c(n,e){var t,i,f="string"==typeof n?JSON.parse(n):n,u=f.length,a=[],l=0;e||(e=f[0],l=1);for(var s=r(e),d=g[s],h=d.fields,p=h.length;u>l;l+=p){for(t={},i=0;p>i;i++)t[h[i]]=o(f[l+i],d.meta[i],c,1);if(e==s)return t;a.push(t)}return a}function l(n){if("string"==typeof n&&(n=c(n)),n.id===void 0)for(var e=0;n.length>e;e++)l(n[e]);else g[n.id]=n,u(n)}var s={"enum":function(n){return function(e,t){return t?n.indexOf(e):n[e]}},prefix:function(n){var e=RegExp("^"+n[0]);return function(t,r){return r?t.replace(e,""):n[0]+t}},suffix:function(n){var e=RegExp(n[0]+"$");return function(t,r){return r?t.replace(e,""):t+n[0]}}},g={schema:{id:"schema",fields:["id","fields","meta"],meta:[0,"[]","[]"]}};n.KSON=e.exports={coders:s,addSchema:l,parse:c,stringify:a}})(this,"undefined"==typeof module?{}:module);