(function(n,e){function t(n){return"["==n[0]?n.slice(2):n}function r(n,e){return function(t){for(var r=n.length,i=e>0?0:r-1,u=e>0?r:-1;i!=u;i+=e)t=n[i](t);return t}}function i(n){var e,t,i,u,f,o,c,a,s;if(n&&!d[n]){for(c=n.match(/(\\.|[^\|])+/g),f=[],o=[],e=c.length-1;e>=0;e--){if(a=c[e].match(/(\\.|[^:])+/g),codec_id=a[0],!d[codec_id])return;if(i=d[codec_id],u=l[codec_id],a=a.slice(1),s=a.length,s>0){for(t=0;s>t;t++)a[t]=a[t].replace("\\","");i=i(a),u=u(a)}f[e]=i,o[e]=u}d[n]=r(f,1),l[n]=r(o,-1)}}function u(n){for(var e=n.meta.length-1;e>=0;e--)i(t(n.meta[e]))}function f(n,e,r,i){var u,f=t(e),o=i[f];if(null!==n&&void 0!==n)if(s[f])n=r(n,e,1);else if(o)if(f==e)n=o(n);else for(n=n.slice(0),u=n.length-1;u>=0;u--)n[u]=o(n[u]);return n}function o(n,e,r){var i,u,c,a=t(e),l=s[a],g=l.fields,h=[];r||(h[0]=e),a==e&&(n=[n]);var p=n.length,m=g.length;for(i=0;p>i;i++)for(c=n[i],u=0;m>u;u++)h.push(f(c[g[u]],l.meta[u],o,d));return r?h:JSON.stringify(h)}function c(n,e){var r,i,u="string"==typeof n?JSON.parse(n):n,o=u.length,a=[],d=0;e||(e=u[0],d=1);for(var g=t(e),h=s[g],p=h.fields,m=p.length;o>d;d+=m){for(r={},i=0;m>i;i++)r[p[i]]=f(u[d+i],h.meta[i],c,l);if(e==g)return r;a.push(r)}return a}function a(n){if("string"==typeof n&&(n=c(n)),n.id===void 0)for(var e=n.length-1;e>=0;e--)a(n[e]);else u(n),s[n.id]=n}var d={"enum":function(n){return function(e){return n.indexOf(e)}},prefix:function(n){var e=RegExp("^"+n[0]);return function(n){return n.replace(e,"")}},suffix:function(n){var e=RegExp(n[0]+"$");return function(n){return n.replace(e,"")}},bool:function(n){return n&&1||0},int36:function(n){return n.toString(36)},date:function(n){return Math.round(n/1e3)}},l={"enum":function(n){return function(e){return n[e]}},prefix:function(n){return function(e){return n[0]+e}},suffix:function(n){return function(e){return e+n[0]}},bool:function(n){return n&&!0||!1},int36:function(n){return parseInt(n,36)},date:function(n){return new Date(1e3*n)}},s={schema:{id:"schema",fields:["id","fields","meta"],meta:[0,"[]","[]"]}};n.KSON=e.exports={addCodec:function(n,e,t){d[n]=e,l[n]=t},addSchema:a,parse:c,stringify:o}})(this,"undefined"==typeof module?{}:module);